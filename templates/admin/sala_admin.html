{% extends 'admin/base_admin.html' %}
{% load static %}
{% load widget_tweaks %}
{% block title %}P√°gina Inicial | Admin{% endblock %}

{% block content %}

<div class="w-full ">
    <div class="content-center-space" style="min-height: calc(100vh - 25rem - 96px); display:flex; align-items:start; justify-content:center; flex-direction:column; padding:1rem 0;">
        <h2 class="-mb-1 text-heading-h3">Salas</h2>
        <p class="-mt-1 text-heading-h5">Gerencie todas as salas do sistema!</p>
    </div>

    <div id="modalDetalhes" class="hidden fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm  items-center justify-center z-50">
</div>

    <!-- painel fixo no fim da p√°gina com altura espec√≠fica (ajuste h-96 conforme necess√°rio) -->
    <div id="salasPanel" class="fixed left-0 right-0 bottom-0 px-20 z-40">
        <div class="mx-auto w-full bg-blue-0 rounded-t-xl shadow-xl flex flex-col overflow-hidden" style=" height:28rem; ">
            <!-- barra de pesquisa / filtro / bot√£o: n√£o rola -->
            <div class="px-4 py-3 flex items-center gap-4 flex-none">
                <form class="flex w-full items-center justify-between" method="get" >
                    <input type="text" name="busca" value="{{ busca }}" placeholder="Pesquisar Agendamentos"
                           class="bg-white rounded-md px-3 py-1 w-3/4">
                    <div class="flex items-center ml-4 ">
                        <select id="ordenar_por" name="ordenar_por" onchange="this.form.submit()" class="appearance-none bg-white rounded-md px-2 py-1">
                            <option disabled selected hidden>Filtrar</option>
                            <option value="codigo_agendamento" {% if ordenar_por == 'codigo_agendamento' %}selected{% endif %}>ID</option>
                            <option value="nome" {% if ordenar_por == 'nome' %}selected{% endif %}>Nome</option>
                            <option value="capacidade" {% if ordenar_por == 'capacidade' %}selected{% endif %}>Capacidade</option>
                            <option value="tipo_sala" {% if ordenar_por == 'tipo_sala' %}selected{% endif %}>Tipo</option>
                        </select>
                        {% if ordenar_por %}
                            <a id="limparFiltro"
                               class="ml-2 px-3 py-1 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors duration-200"
                               href="?{% if busca %}busca={{ busca|urlencode }}{% endif %}">
                                Limpar filtro
                            </a>
                        {% endif %}
                        <button type="button" id="abrirModalSala"
                                class="ml-3 px-3 py-1 bg-darkBlue-900 text-white rounded-md hover:bg-blue-800 transition-colors duration-200">
                            Nova Sala
                        </button>
                    </div>
                </form>
            </div>

            <!-- container da tabela com scroll interno -->
            <div class="flex-1 bg-white  overflow-hidden rounded-t-lg">
                <div class="h-full overflow-y-auto px-7">
                    <table class="min-w-full">
                        <thead class="bg-white sticky top-0">
                            <tr class="border-b border-darkBlue-900">
                                <th class="text-left px-5 py-2">ID</th>
                                <th class="text-left px-5 py-2">Nome</th>
                                <th class="text-left px-5 py-2">Tipo</th>
                                <th class="text-left px-5 py-2">Capacidade</th>
                                <th class="text-left px-5 py-2">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for sala in salas %}
                            <tr class=" border-b border-white hover:bg-blue-900 hover:text-white">
                                <td class="px-5 py-2">{{ sala.id }}</td>
                                <td class="px-5 py-2 cursor-pointer hover:underline"
                                    onclick="abrirDetalhesAgendamento('{{ agendamento.id }}')"
                                    data-id="{{ agendamento.id }}">
                                    {{ sala.nome }}
                                </td>
                                <td class="px-5 py-2">{{ sala.tipo_sala }}</td>
                                <td class="px-5 py-2">{{ sala.capacidade }}</td>
                                <td class="px-5 py-2 flex gap-3 justify-start">
                                <button onclick="abrirModalEditar('{{ agendamento.id }}')" 
                                    class="flex items-center gap-2 px-4 py-2 rounded-full text-darkBlue-900 hover:bg-darkBlue-900 hover:text-white transition">
                                    <span class="w-5 h-5 bg-current mask-edit"></span>
                                </button>
                                <button onclick="abrirModalExcluir('{{ agendamento.id }}')"
                                        class=" hover:underline  duration-200">
                                    üóëÔ∏è 
                                </button>
                            </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="6" class="px-4 py-2 text-center">Nenhuma sala encontrada.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Criar Sala -->
    <div id="modalSala"
        class="hidden fixed inset-0 z-50 items-center justify-center transition-opacity duration-300 opacity-0"
        style="background-color: rgba(255,255,255,0.08); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px);">

        <div id="modalContentSala"
            class="bg-white rounded-2xl shadow-2xl w-full max-w-lg p-8 relative transform scale-95 transition-all duration-300">
            
            <!-- Bot√£o Fechar -->
            <button id="fecharModalSala" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-xl">‚úï</button>

            <h2 class="text-2xl font-semibold text-darkBlue-900 mb-6 text-center">Cadastrar Nova Sala</h2>

            <form id="formSala" method="POST" action="{% url 'criar_sala' %}" class="flex flex-col gap-4">
                {% csrf_token %}
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Sala</label>
                    {{ form.nome|add_class:"w-full border-gray-300 rounded-lg focus:ring-darkBlue-900 focus:border-darkBlue-900 px-3 py-2" }}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Capacidade</label>
                    {{ form.capacidade|add_class:"w-full border-gray-300 rounded-lg focus:ring-darkBlue-900 focus:border-darkBlue-900 px-3 py-2" }}
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo da Sala</label>
                    {{ form.tipo_sala|add_class:"w-full border-gray-300 rounded-lg focus:ring-darkBlue-900 focus:border-darkBlue-900 px-3 py-2" }}
                </div>

                <div class="flex justify-end gap-3 mt-6">
                    <button type="button" id="cancelarSalaBtn"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition">
                        Cancelar
                    </button>
                    <button type="submit" id="submitSalaBtn"
                        class="px-4 py-2 bg-darkBlue-900 text-white rounded-lg hover:bg-blue-800 transition">
                        Salvar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="modalEditar" class="hidden fixed inset-0 bg-black bg-opacity-50 items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-1/3 shadow-lg">
        <h3 class="text-xl font-semibold mb-4">Editar Agendamento</h3>
        <form id="formEditar">
            {% csrf_token %}
            <input type="hidden" id="editId">
            <div class="mb-3">
                <label>Nome:</label>
                <input type="text" id="editNome" class="w-full border rounded px-2 py-1">
            </div>
            <div class="mb-3">
                <label>Data:</label>
                <input type="date" id="editData" class="w-full border rounded px-2 py-1">
            </div>
            <div class="mb-3">
                <label>Hora In√≠cio:</label>
                <input type="time" id="editHora" class="w-full border rounded px-2 py-1">
            </div>
            <div class="flex justify-end gap-2 mt-4">
                <button type="button" onclick="fecharModalEditar()" class="bg-gray-300 px-3 py-1 rounded">Cancelar</button>
                <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded">Salvar</button>
            </div>
        </form>
    </div>
</div>

<!-- Modal Excluir -->
<div id="modalExcluir" class="hidden fixed inset-0 bg-black bg-opacity-50  items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-1/3 shadow-lg text-center">
        <h3 class="text-lg font-semibold mb-4">Excluir Agendamento</h3>
        <p class="mb-4">Tem certeza que deseja excluir este agendamento?</p>
        <div class="flex justify-center gap-4">
            <button onclick="fecharModalExcluir()" class="bg-gray-300 px-4 py-2 rounded">Cancelar</button>
            <button onclick="confirmarExclusao()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded">Excluir</button>
        </div>
    </div>
</div>


<script src="{% static 'js/nova_sala.js' %}" defer></script>

</div>
{% endblock %}